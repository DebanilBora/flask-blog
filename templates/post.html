{% extends "base.html" %}
{% from "bootstrap5/form.html" import render_form %}
{% block content %}

<!-- Page Header -->
<header class="masthead" style="background-image: url('{{ post.img_url }}')">
  <div class="container position-relative px-4 px-lg-5">
    <div class="row gx-4 gx-lg-5 justify-content-center">
      <div class="col-md-10 col-lg-8 col-xl-7">
        <div class="post-heading">
          <h1>{{ post.title }}</h1>
          <h2 class="subheading">{{ post.subtitle }}</h2>
          <span class="meta">Posted by {{ post.author.name }} on {{ post.date }}</span>

          {% if current_user.is_authenticated and (current_user.id == 1 or current_user.id == post.author.id) %}
          <!-- âœ… Admin or Author Options -->
          <div class="mt-3">
            <a href="{{ url_for('edit_post', post_id=post.id) }}" class="btn btn-sm btn-warning me-2">Edit</a>
            <a href="{{ url_for('delete_post', post_id=post.id) }}"
               class="btn btn-sm btn-danger"
               onclick="return confirm('Are you sure you want to delete this post?');">Delete</a>
          </div>
          {% endif %}

        </div>
      </div>
    </div>
  </div>
</header>

<!-- Post Content -->
<article class="mb-4">
  <div class="container px-4 px-lg-5">
    <div class="row justify-content-center">
      <div class="col-md-10 col-lg-8 col-xl-7">
        {{ post.body | safe }}

        <hr>
        <h4>Comments</h4>
        {% for comment in post.comments %}
        <div class="d-flex mb-4">
          <img src="{{ gravatar(comment.comment_author.email) }}" class="rounded-circle me-3" width="50" height="50">
          <div>
            <strong>{{ comment.comment_author.name }}</strong>
            <div>{{ comment.text | safe }}</div>
          </div>
        </div>
        {% endfor %}

        <hr>
        <h4>Leave a Comment</h4>
        {{ render_form(form, novalidate=True) }}
      </div>
    </div>
  </div>
</article>

{% endblock %}
